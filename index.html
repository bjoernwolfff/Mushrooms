<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pilzerkennung (MobileNet, TFJS)</title>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.8.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@2.1.0/dist/mobilenet.min.js"></script>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 20px;
    background: #f0f8ff;
    color: #333;
  }
  h1 {
    text-align: center;
    color: #2a6ebb;
  }
  #container {
    max-width: 480px;
    margin: auto;
    background: white;
    padding: 15px;
    border-radius: 12px;
    box-shadow: 0 0 12px rgba(0,0,0,0.1);
  }
  input[type="file"] {
    width: 100%;
    padding: 10px;
    margin-bottom: 15px;
    border-radius: 8px;
    border: 1px solid #ccc;
  }
  img {
    max-width: 100%;
    border-radius: 12px;
    margin-bottom: 15px;
  }
  button {
    background-color: #2a6ebb;
    color: white;
    border: none;
    padding: 12px;
    width: 100%;
    font-size: 16px;
    border-radius: 10px;
    cursor: pointer;
  }
  button:disabled {
    background-color: #99bde9;
    cursor: not-allowed;
  }
  #result {
    margin-top: 15px;
    text-align: center;
    font-weight: bold;
    font-size: 18px;
    color: #2a6ebb;
    min-height: 40px;
  }
</style>
</head>
<body>
  <div id="container">
    <h1>Pilzerkennung</h1>
    <input type="file" id="imageUpload" accept="image/*" />
    <img id="preview" src="" alt="Bildvorschau" style="display:none;" />
    <button id="predictBtn" disabled>Erkennen</button>
    <div id="result"></div>
  </div>

<script>
  let model;
  const imageUpload = document.getElementById('imageUpload');
  const preview = document.getElementById('preview');
  const predictBtn = document.getElementById('predictBtn');
  const result = document.getElementById('result');

  async function loadModel() {
    result.textContent = 'Modell wird geladen...';
    model = await mobilenet.load();
    result.textContent = 'Modell geladen. Bitte Bild hochladen.';
    predictBtn.disabled = false;
  }

  imageUpload.addEventListener('change', (event) => {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      preview.src = reader.result;
      preview.style.display = 'block';
      result.textContent = '';
    };
    reader.readAsDataURL(file);
  });

  predictBtn.addEventListener('click', async () => {
    if (!model) return;
    result.textContent = 'Erkenne...';
    const predictions = await model.classify(preview);
    if (predictions.length > 0) {
      // Zeige nur die Top 3 Ergebnisse
      result.innerHTML = predictions.slice(0, 3).map(p => 
        `${p.className} — ${(p.probability * 100).toFixed(1)}%`
      ).join('<br>');
    } else {
      result.textContent = 'Keine Vorhersagen möglich.';
    }
  });

  loadModel();
</script>
</body>
</html>


